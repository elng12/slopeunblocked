<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slope Unblocked 图标生成器</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
            color: #e5e5e5;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #10b981, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            font-size: 1.1rem;
            color: #9ca3af;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }
        
        .preview-section {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(16, 185, 129, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .controls-section {
            background: rgba(16, 33, 62, 0.8);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .preview-canvas {
            display: block;
            margin: 0 auto 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #10b981;
        }
        
        .control-group input,
        .control-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #e5e5e5;
            font-size: 14px;
        }
        
        .color-input {
            height: 45px;
            cursor: pointer;
        }
        
        .btn {
            background: linear-gradient(45deg, #10b981, #3b82f6);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #6b7280, #4b5563);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 5px 15px rgba(107, 114, 128, 0.4);
        }
        
        .download-section {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(139, 92, 246, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .download-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .download-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .download-item:hover {
            border-color: #10b981;
            transform: translateY(-2px);
        }
        
        .download-item h4 {
            margin-bottom: 10px;
            color: #10b981;
        }
        
        .download-item .size {
            font-size: 12px;
            color: #9ca3af;
            margin-bottom: 10px;
        }
        
        .download-link {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .download-link:hover {
            background: #059669;
            transform: scale(1.05);
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(16, 185, 129, 0.3);
            border-top: 4px solid #10b981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .format-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .format-tab {
            flex: 1;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: #e5e5e5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .format-tab.active {
            background: #10b981;
            border-color: #10b981;
        }
        
        .preset-icons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .preset-icon {
            width: 50px;
            height: 50px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .preset-icon:hover {
            border-color: #10b981;
            transform: scale(1.1);
        }
        
        .preset-icon.active {
            border-color: #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .download-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .preset-icons {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .status-message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        .status-success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            color: #10b981;
        }
        
        .status-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #ef4444;
        }
        
        .status-info {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
            color: #3b82f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Slope Unblocked 图标生成器</h1>
            <p>为您的游戏创建专业的图标和favicon</p>
        </div>
        
        <div class="main-content">
            <!-- 预览区域 -->
            <div class="preview-section">
                <h3 style="margin-bottom: 20px; color: #10b981;">图标预览</h3>
                <canvas id="preview-canvas" class="preview-canvas" width="256" height="256"></canvas>
                
                <div class="format-tabs">
                    <div class="format-tab active" data-format="png">PNG</div>
                    <div class="format-tab" data-format="svg">SVG</div>
                    <div class="format-tab" data-format="webp">WebP</div>
                    <div class="format-tab" data-format="ico">ICO</div>
                </div>
                
                <div class="preset-icons">
                    <div class="preset-icon active" data-preset="slope" style="background: linear-gradient(45deg, #10b981, #059669); position: relative;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 20px; font-weight: bold;">S</div>
                    </div>
                    <div class="preset-icon" data-preset="ball" style="background: radial-gradient(circle, #3b82f6, #1d4ed8); position: relative;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 24px;">●</div>
                    </div>
                    <div class="preset-icon" data-preset="arrow" style="background: linear-gradient(45deg, #8b5cf6, #7c3aed); position: relative;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 20px;">↓</div>
                    </div>
                    <div class="preset-icon" data-preset="geometric" style="background: linear-gradient(45deg, #f59e0b, #d97706); position: relative;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 18px; font-weight: bold;">◆</div>
                    </div>
                    <div class="preset-icon" data-preset="minimal" style="background: #1f2937; position: relative;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #10b981; font-size: 16px; font-weight: bold;">S</div>
                    </div>
                    <div class="preset-icon" data-preset="neon" style="background: #000; position: relative; box-shadow: 0 0 10px #10b981;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #00ff88; font-size: 18px; font-weight: bold; text-shadow: 0 0 5px #00ff88;">⚡</div>
                    </div>
                </div>
            </div>
            
            <!-- 控制区域 -->
            <div class="controls-section">
                <h3 style="margin-bottom: 20px; color: #3b82f6;">自定义设置</h3>
                
                <div class="control-group">
                    <label>预设样式</label>
                    <select id="preset-select">
                        <option value="slope">斜坡样式</option>
                        <option value="ball">球体样式</option>
                        <option value="arrow">箭头样式</option>
                        <option value="geometric">几何样式</option>
                        <option value="minimal">极简样式</option>
                        <option value="neon">霓虹样式</option>
                        <option value="custom">自定义</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>背景颜色</label>
                    <input type="color" id="bg-color" class="color-input" value="#10b981">
                </div>
                
                <div class="control-group">
                    <label>文字颜色</label>
                    <input type="color" id="text-color" class="color-input" value="#ffffff">
                </div>
                
                <div class="control-group">
                    <label>图标文字</label>
                    <input type="text" id="icon-text" placeholder="输入文字" value="S">
                </div>
                
                <div class="control-group">
                    <label>字体大小</label>
                    <input type="range" id="font-size" min="20" max="80" value="40">
                    <span id="font-size-value">40px</span>
                </div>
                
                <div class="control-group">
                    <label>渐变效果</label>
                    <select id="gradient-type">
                        <option value="none">无渐变</option>
                        <option value="linear">线性渐变</option>
                        <option value="radial">径向渐变</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>渐变颜色</label>
                    <input type="color" id="gradient-color" class="color-input" value="#059669">
                </div>
                
                <div class="control-group">
                    <label>阴影效果</label>
                    <select id="shadow-type">
                        <option value="none">无阴影</option>
                        <option value="soft">柔和阴影</option>
                        <option value="neon">霓虹阴影</option>
                        <option value="glow">发光效果</option>
                    </select>
                </div>
                
                <button id="generate-btn" class="btn">
                    生成图标
                </button>
                
                <button id="reset-btn" class="btn btn-secondary">
                    重置设置
                </button>
            </div>
        </div>
        
        <!-- 下载区域 -->
        <div class="download-section">
            <h3 style="margin-bottom: 20px; color: #8b5cf6;">生成的图标</h3>
            
            <div id="status-message" class="status-message" style="display: none;"></div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="margin-top: 10px;">正在生成图标...</p>
            </div>
            
            <div id="downloads" class="download-grid">
                <!-- 下载链接将在这里生成 -->
            </div>
            
            <div style="margin-top: 20px; text-align: center;">
                <button id="download-all-btn" class="btn" style="display: none;">
                    下载所有图标
                </button>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let currentFormat = 'png';
        let currentPreset = 'slope';
        let generatedIcons = [];
        
        // 标准图标尺寸
        const ICON_SIZES = {
            favicon: [16, 32, 48],
            apple: [57, 60, 72, 76, 114, 120, 144, 152, 167, 180, 192, 256, 512, 1024],
            android: [36, 48, 72, 96, 144, 192, 256, 384, 512],
            ms: [70, 144, 150, 310],
            general: [72, 96, 128, 144, 152, 192, 256, 384, 512]
        };
        
        // 预设配置
        const PRESETS = {
            slope: {
                bgColor: '#10b981',
                textColor: '#ffffff',
                iconText: 'S',
                fontSize: 40,
                gradientType: 'linear',
                gradientColor: '#059669',
                shadowType: 'soft'
            },
            ball: {
                bgColor: '#3b82f6',
                textColor: '#ffffff',
                iconText: '●',
                fontSize: 50,
                gradientType: 'radial',
                gradientColor: '#1d4ed8',
                shadowType: 'glow'
            },
            arrow: {
                bgColor: '#8b5cf6',
                textColor: '#ffffff',
                iconText: '↓',
                fontSize: 45,
                gradientType: 'linear',
                gradientColor: '#7c3aed',
                shadowType: 'neon'
            },
            geometric: {
                bgColor: '#f59e0b',
                textColor: '#ffffff',
                iconText: '◆',
                fontSize: 35,
                gradientType: 'linear',
                gradientColor: '#d97706',
                shadowType: 'soft'
            },
            minimal: {
                bgColor: '#1f2937',
                textColor: '#10b981',
                iconText: 'S',
                fontSize: 35,
                gradientType: 'none',
                gradientColor: '#1f2937',
                shadowType: 'none'
            },
            neon: {
                bgColor: '#000000',
                textColor: '#00ff88',
                iconText: '⚡',
                fontSize: 40,
                gradientType: 'none',
                gradientColor: '#000000',
                shadowType: 'neon'
            }
        };
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updatePreview();
        });
        
        // 设置事件监听器
        function setupEventListeners() {
            // 格式标签切换
            document.querySelectorAll('.format-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.format-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentFormat = this.dataset.format;
                    updatePreview();
                });
            });
            
            // 预设图标点击
            document.querySelectorAll('.preset-icon').forEach(icon => {
                icon.addEventListener('click', function() {
                    document.querySelectorAll('.preset-icon').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    currentPreset = this.dataset.preset;
                    applyPreset(currentPreset);
                });
            });
            
            // 预设选择
            document.getElementById('preset-select').addEventListener('change', function() {
                if (this.value !== 'custom') {
                    applyPreset(this.value);
                }
            });
            
            // 颜色输入
            document.getElementById('bg-color').addEventListener('input', updatePreview);
            document.getElementById('text-color').addEventListener('input', updatePreview);
            document.getElementById('gradient-color').addEventListener('input', updatePreview);
            
            // 文字输入
            document.getElementById('icon-text').addEventListener('input', updatePreview);
            
            // 字体大小
            document.getElementById('font-size').addEventListener('input', function() {
                document.getElementById('font-size-value').textContent = this.value + 'px';
                updatePreview();
            });
            
            // 效果选择
            document.getElementById('gradient-type').addEventListener('change', updatePreview);
            document.getElementById('shadow-type').addEventListener('change', updatePreview);
            
            // 按钮
            document.getElementById('generate-btn').addEventListener('click', generateIcons);
            document.getElementById('reset-btn').addEventListener('click', resetSettings);
            document.getElementById('download-all-btn').addEventListener('click', downloadAllIcons);
        }
        
        // 应用预设
        function applyPreset(presetName) {
            const preset = PRESETS[presetName];
            if (preset) {
                document.getElementById('bg-color').value = preset.bgColor;
                document.getElementById('text-color').value = preset.textColor;
                document.getElementById('icon-text').value = preset.iconText;
                document.getElementById('font-size').value = preset.fontSize;
                document.getElementById('font-size-value').textContent = preset.fontSize + 'px';
                document.getElementById('gradient-type').value = preset.gradientType;
                document.getElementById('gradient-color').value = preset.gradientColor;
                document.getElementById('shadow-type').value = preset.shadowType;
                document.getElementById('preset-select').value = presetName;
                
                updatePreview();
            }
        }
        
        // 更新预览
        function updatePreview() {
            const canvas = document.getElementById('preview-canvas');
            const ctx = canvas.getContext('2d');
            
            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 获取设置
            const bgColor = document.getElementById('bg-color').value;
            const textColor = document.getElementById('text-color').value;
            const iconText = document.getElementById('icon-text').value;
            const fontSize = parseInt(document.getElementById('font-size').value);
            const gradientType = document.getElementById('gradient-type').value;
            const gradientColor = document.getElementById('gradient-color').value;
            const shadowType = document.getElementById('shadow-type').value;
            
            // 绘制背景
            if (gradientType !== 'none') {
                let gradient;
                if (gradientType === 'linear') {
                    gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                } else if (gradientType === 'radial') {
                    gradient = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, canvas.width/2);
                }
                gradient.addColorStop(0, bgColor);
                gradient.addColorStop(1, gradientColor);
                ctx.fillStyle = gradient;
            } else {
                ctx.fillStyle = bgColor;
            }
            
            // 绘制圆角矩形背景
            const radius = 30;
            ctx.beginPath();
            ctx.moveTo(radius, 0);
            ctx.lineTo(canvas.width - radius, 0);
            ctx.quadraticCurveTo(canvas.width, 0, canvas.width, radius);
            ctx.lineTo(canvas.width, canvas.height - radius);
            ctx.quadraticCurveTo(canvas.width, canvas.height, canvas.width - radius, canvas.height);
            ctx.lineTo(radius, canvas.height);
            ctx.quadraticCurveTo(0, canvas.height, 0, canvas.height - radius);
            ctx.lineTo(0, radius);
            ctx.quadraticCurveTo(0, 0, radius, 0);
            ctx.closePath();
            ctx.fill();
            
            // 添加阴影效果
            if (shadowType !== 'none') {
                ctx.save();
                if (shadowType === 'soft') {
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                    ctx.shadowBlur = 10;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 5;
                } else if (shadowType === 'neon') {
                    ctx.shadowColor = textColor;
                    ctx.shadowBlur = 20;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 0;
                } else if (shadowType === 'glow') {
                    ctx.shadowColor = textColor;
                    ctx.shadowBlur = 15;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 0;
                }
            }
            
            // 绘制文字
            ctx.fillStyle = textColor;
            ctx.font = `bold ${fontSize}px Arial, sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(iconText, canvas.width / 2, canvas.height / 2);
            
            if (shadowType !== 'none') {
                ctx.restore();
            }
        }
        
        // 生成图标
        async function generateIcons() {
            const loading = document.getElementById('loading');
            const downloads = document.getElementById('downloads');
            const downloadAllBtn = document.getElementById('download-all-btn');
            const statusMessage = document.getElementById('status-message');
            
            // 显示加载状态
            loading.style.display = 'block';
            downloads.innerHTML = '';
            downloadAllBtn.style.display = 'none';
            statusMessage.style.display = 'none';
            generatedIcons = [];
            
            try {
                // 获取所有尺寸
                const allSizes = [];
                Object.values(ICON_SIZES).forEach(sizes => {
                    allSizes.push(...sizes);
                });
                const uniqueSizes = [...new Set(allSizes)].sort((a, b) => a - b);
                
                // 为每个尺寸生成图标
                for (const size of uniqueSizes) {
                    await generateIconForSize(size);
                }
                
                // 生成manifest.json
                await generateManifest();
                
                // 生成HTML代码片段
                await generateHTMLSnippet();
                
                // 显示成功消息
                showStatus('success', `成功生成了 ${uniqueSizes.length} 个图标！`);
                downloadAllBtn.style.display = 'inline-block';
                
            } catch (error) {
                console.error('生成图标时出错:', error);
                showStatus('error', '生成图标时出错: ' + error.message);
            } finally {
                loading.style.display = 'none';
            }
        }
        
        // 为特定尺寸生成图标
        async function generateIconForSize(size) {
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            
            // 获取设置
            const bgColor = document.getElementById('bg-color').value;
            const textColor = document.getElementById('text-color').value;
            const iconText = document.getElementById('icon-text').value;
            const fontSize = parseInt(document.getElementById('font-size').value);
            const gradientType = document.getElementById('gradient-type').value;
            const gradientColor = document.getElementById('gradient-color').value;
            const shadowType = document.getElementById('shadow-type').value;
            
            // 计算相对字体大小
            const relativeFontSize = Math.max(16, Math.floor(size * fontSize / 256));
            
            // 绘制背景
            if (gradientType !== 'none') {
                let gradient;
                if (gradientType === 'linear') {
                    gradient = ctx.createLinearGradient(0, 0, size, size);
                } else if (gradientType === 'radial') {
                    gradient = ctx.createRadialGradient(size/2, size/2, 0, size/2, size/2, size/2);
                }
                gradient.addColorStop(0, bgColor);
                gradient.addColorStop(1, gradientColor);
                ctx.fillStyle = gradient;
            } else {
                ctx.fillStyle = bgColor;
            }
            
            // 绘制圆角矩形
            const radius = Math.floor(size * 0.15);
            ctx.beginPath();
            ctx.moveTo(radius, 0);
            ctx.lineTo(size - radius, 0);
            ctx.quadraticCurveTo(size, 0, size, radius);
            ctx.lineTo(size, size - radius);
            ctx.quadraticCurveTo(size, size, size - radius, size);
            ctx.lineTo(radius, size);
            ctx.quadraticCurveTo(0, size, 0, size - radius);
            ctx.lineTo(0, radius);
            ctx.quadraticCurveTo(0, 0, radius, 0);
            ctx.closePath();
            ctx.fill();
            
            // 添加阴影效果
            if (shadowType !== 'none') {
                ctx.save();
                if (shadowType === 'soft') {
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                    ctx.shadowBlur = Math.floor(size * 0.05);
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = Math.floor(size * 0.02);
                } else if (shadowType === 'neon') {
                    ctx.shadowColor = textColor;
                    ctx.shadowBlur = Math.floor(size * 0.1);
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 0;
                } else if (shadowType === 'glow') {
                    ctx.shadowColor = textColor;
                    ctx.shadowBlur = Math.floor(size * 0.08);
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 0;
                }
            }
            
            // 绘制文字
            ctx.fillStyle = textColor;
            ctx.font = `bold ${relativeFontSize}px Arial, sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(iconText, size / 2, size / 2);
            
            if (shadowType !== 'none') {
                ctx.restore();
            }
            
            // 生成不同格式的图像
            const formats = ['png', 'webp'];
            for (const format of formats) {
                try {
                    let dataUrl;
                    if (format === 'png') {
                        dataUrl = canvas.toDataURL('image/png');
                    } else if (format === 'webp') {
                        dataUrl = canvas.toDataURL('image/webp');
                    }
                    
                    if (dataUrl) {
                        const iconData = {
                            size: size,
                            format: format,
                            dataUrl: dataUrl,
                            filename: `icon-${size}x${size}.${format}`
                        };
                        generatedIcons.push(iconData);
                        
                        // 添加到下载区域
                        addDownloadLink(iconData);
                    }
                } catch (error) {
                    console.warn(`生成 ${format} 格式失败:`, error);
                }
            }
        }
        
        // 添加下载链接
        function addDownloadLink(iconData) {
            const downloads = document.getElementById('downloads');
            const downloadItem = document.createElement('div');
            downloadItem.className = 'download-item';
            
            const sizeInKB = Math.round(iconData.dataUrl.length * 0.75 / 1024);
            
            downloadItem.innerHTML = `
                <h4>${iconData.filename}</h4>
                <p class="size">${iconData.size}×${iconData.size}px • ${sizeInKB}KB</p>
                <a href="${iconData.dataUrl}" download="${iconData.filename}" class="download-link">
                    下载
                </a>
            `;
            
            downloads.appendChild(downloadItem);
        }
        
        // 生成manifest.json
        async function generateManifest() {
            const manifest = {
                name: "Slope Unblocked",
                short_name: "Slope",
                description: "Play Slope Unblocked online for free!",
                start_url: "/",
                display: "standalone",
                background_color: document.getElementById('bg-color').value,
                theme_color: document.getElementById('bg-color').value,
                orientation: "any",
                icons: []
            };
            
            // 添加图标到manifest
            const sizes = [72, 96, 128, 144, 152, 192, 256, 384, 512];
            for (const size of sizes) {
                const pngIcon = generatedIcons.find(icon => icon.size === size && icon.format === 'png');
                if (pngIcon) {
                    manifest.icons.push({
                        src: `icons/${pngIcon.filename}`,
                        sizes: `${size}x${size}`,
                        type: "image/png",
                        purpose: "any"
                    });
                }
            }
            
            const manifestJson = JSON.stringify(manifest, null, 2);
            const manifestBlob = new Blob([manifestJson], { type: 'application/json' });
            const manifestUrl = URL.createObjectURL(manifestBlob);
            
            const downloads = document.getElementById('downloads');
            const manifestItem = document.createElement('div');
            manifestItem.className = 'download-item';
            manifestItem.innerHTML = `
                <h4>manifest.json</h4>
                <p class="size">PWA配置文件</p>
                <a href="${manifestUrl}" download="manifest.json" class="download-link">
                    下载
                </a>
            `;
            downloads.appendChild(manifestItem);
        }
        
        // 生成HTML代码片段
        async function generateHTMLSnippet() {
            const bgColor = document.getElementById('bg-color').value;
            const htmlSnippet = `
<!-- Slope Unblocked Icons -->
<link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="${bgColor}">
<meta name="msapplication-TileColor" content="${bgColor}">
<meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
            `.trim();
            
            const blob = new Blob([htmlSnippet], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const downloads = document.getElementById('downloads');
            const htmlItem = document.createElement('div');
            htmlItem.className = 'download-item';
            htmlItem.innerHTML = `
                <h4>HTML代码片段</h4>
                <p class="size">图标引用代码</p>
                <a href="${url}" download="icon-snippets.html" class="download-link">
                    下载
                </a>
            `;
            downloads.appendChild(htmlItem);
        }
        
        // 下载所有图标
        function downloadAllIcons() {
            if (generatedIcons.length === 0) {
                showStatus('error', '没有可下载的图标');
                return;
            }
            
            let downloadedCount = 0;
            generatedIcons.forEach(icon => {
                const link = document.createElement('a');
                link.href = icon.dataUrl;
                link.download = icon.filename;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                downloadedCount++;
            });
            
            showStatus('success', `开始下载 ${downloadedCount} 个图标...`);
        }
        
        // 重置设置
        function resetSettings() {
            applyPreset('slope');
            showStatus('info', '设置已重置为默认斜坡样式');
        }
        
        // 显示状态消息
        function showStatus(type, message) {
            const statusMessage = document.getElementById('status-message');
            statusMessage.className = `status-message status-${type}`;
            statusMessage.textContent = message;
            statusMessage.style.display = 'block';
            
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }
        
        // 生成SVG图标
        function generateSVGIcon(size) {
            const bgColor = document.getElementById('bg-color').value;
            const textColor = document.getElementById('text-color').value;
            const iconText = document.getElementById('icon-text').value;
            const fontSize = parseInt(document.getElementById('font-size').value);
            const gradientType = document.getElementById('gradient-type').value;
            const gradientColor = document.getElementById('gradient-color').value;
            
            const relativeFontSize = Math.max(16, Math.floor(size * fontSize / 256));
            const radius = Math.floor(size * 0.15);
            
            let svgContent = `<svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                <defs>
            `;
            
            if (gradientType !== 'none') {
                const gradientId = 'gradient' + Math.random().toString(36).substr(2, 9);
                if (gradientType === 'linear') {
                    svgContent += `
                        <linearGradient id="${gradientId}" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:${bgColor}" />
                            <stop offset="100%" style="stop-color:${gradientColor}" />
                        </linearGradient>
                    `;
                } else if (gradientType === 'radial') {
                    svgContent += `
                        <radialGradient id="${gradientId}" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" style="stop-color:${bgColor}" />
                            <stop offset="100%" style="stop-color:${gradientColor}" />
                        </radialGradient>
                    `;
                }
                svgContent += `</defs>
                    <rect width="${size}" height="${size}" rx="${radius}" fill="url(#${gradientId})" />
                `;
            } else {
                svgContent += `</defs>
                    <rect width="${size}" height="${size}" rx="${radius}" fill="${bgColor}" />
                `;
            }
            
            svgContent += `
                <text x="50%" y="50%" text-anchor="middle" dominant-baseline="middle" 
                    font-family="Arial, sans-serif" font-size="${relativeFontSize}" font-weight="bold" 
                    fill="${textColor}">${iconText}</text>
            </svg>
            `;
            
            return svgContent;
        }
    </script>
</body>
</html>